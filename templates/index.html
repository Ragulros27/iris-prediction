<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ML Model Hosting</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <h1>ðŸŒ¿ Iris Flower Classification Model</h1>
      <p>
        This machine learning model predicts iris flower species based on
        measurements
      </p>

      <div class="api-info">
        <h2>API Endpoints:</h2>
        <ul>
          <li><strong>POST /predict</strong> - Single prediction</li>
          <li><strong>POST /batch_predict</strong> - Batch predictions</li>
          <li><strong>GET /health</strong> - Health check</li>
          <li><strong>GET /model-info</strong> - Model information</li>
        </ul>
      </div>

      <div class="test-form">
        <h2>Test the Model</h2>
        <p>
          Enter 4 features: sepal_length, sepal_width, petal_length, petal_width
        </p>

        <form id="predictForm">
          <label>Enter features (comma-separated):</label>
          <input
            type="text"
            id="features"
            placeholder="5.1,3.5,1.4,0.2"
            required
          />
          <button type="submit">Predict</button>
        </form>

        <div class="example">
          <h3>Example inputs:</h3>
          <p>Setosa: 5.1,3.5,1.4,0.2</p>
          <p>Versicolor: 6.0,2.7,5.1,1.6</p>
          <p>Virginica: 6.3,3.3,6.0,2.5</p>
        </div>

        <div id="result"></div>
      </div>
    </div>

    <script>
      document
        .getElementById("predictForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const featuresInput = document.getElementById("features").value;
          const features = featuresInput
            .split(",")
            .map((num) => parseFloat(num.trim()));

          // Validate input
          if (features.length !== 4 || features.some(isNaN)) {
            document.getElementById("result").innerHTML = `
                    <div class="error">
                        Please enter exactly 4 valid numbers separated by commas
                    </div>
                `;
            return;
          }

          try {
            const response = await fetch("/predict", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ features: features }),
            });

            const result = await response.json();

            if (response.ok) {
              document.getElementById("result").innerHTML = `
                        <div class="success">
                            <h3>Prediction Result:</h3>
                            <p>Class: ${result.class_name} (${
                result.prediction
              })</p>
                            <p>Confidence: ${(result.confidence * 100).toFixed(
                              2
                            )}%</p>
                            <p>Probabilities: ${result.probability
                              .map(
                                (p, i) =>
                                  `${classNames[i]}: ${(p * 100).toFixed(1)}%`
                              )
                              .join(", ")}</p>
                        </div>
                    `;
            } else {
              document.getElementById("result").innerHTML = `
                        <div class="error">
                            Error: ${result.error}
                        </div>
                    `;
            }
          } catch (error) {
            document.getElementById("result").innerHTML = `
                    <div class="error">
                        Network error: ${error.message}
                    </div>
                `;
          }
        });

      // Simple class names for display
      const classNames = ["Setosa", "Versicolor", "Virginica"];
    </script>
  </body>
</html>
